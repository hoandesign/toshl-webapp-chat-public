@tailwind base;

@layer base {
  body {
    @apply font-sans bg-app-bg text-black-text;
    /* Add other base body styles from the provided CSS if needed */
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    height: 100%; /* Ensure body takes full height */
    width: 100%; /* Ensure body takes full width */
    margin: 0; /* Reset default margin */
    padding: 0; /* Reset default padding */
  }
  /* Ensure html also has no margin/padding */
  html {
    margin: 0;
    padding: 0;
    height: 100%;
    width: 100%;
  }
  /* Apply box-sizing globally */
  *, :after, :before {
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
  }
}
@tailwind components;
@tailwind utilities;

/* Basic slide-up animation for bottom sheet */
@keyframes slide-up {
  from { transform: translateY(100%); }
  to { transform: translateY(0); }
}

.animate-slide-up {
  animation: slide-up 0.3s ease-out forwards;
}

/* Dimmer background */
@keyframes fade-in-dimmer {
  from { opacity: 0; }
  to { opacity: 1; }
}

.animate-fade-in-dimmer {
  animation: fade-in-dimmer 0.3s ease-out forwards;
}

/* iOS iMessage-style bubble chat */
.message-bubble {
  @apply relative max-w-[75%] px-3 py-2 break-words;
  border-radius: 18px;
  line-height: 1.25;
  word-wrap: break-word;
}

.message-bubble::before,
.message-bubble::after {
  content: "";
  position: absolute;
  bottom: -0.1rem;
  height: 1rem;
}

/* User messages (right side, using Toshl brand colors) */
.message-bubble.from-user {
  @apply bg-navigation-bg text-navigation-text ml-auto;
  align-self: flex-end;
  min-width: 120px; /* Increased minimum width for user messages */
}

.message-bubble.from-user::before {
  border-bottom-left-radius: 0.8rem 0.7rem;
  border-right: 1rem solid theme('colors.navigation-bg');
  right: -0.35rem;
  transform: translate(0, -0.1rem);
}

.message-bubble.from-user::after {
  background-color: theme('colors.app-bg');
  border-bottom-left-radius: 0.5rem;
  right: -40px;
  transform: translate(-30px, -2px);
  width: 10px;
}

/* Bot/System messages (left side, using Toshl brand colors) */
.message-bubble.from-bot {
  @apply bg-card-bg text-black-text;
  align-self: flex-start;
}

.message-bubble.from-bot::before {
  border-bottom-right-radius: 0.8rem 0.7rem;
  border-left: 1rem solid theme('colors.card-bg');
  left: -0.35rem;
  transform: translate(0, -0.1rem);
}

.message-bubble.from-bot::after {
  background-color: theme('colors.app-bg');
  border-bottom-right-radius: 0.5rem;
  left: 20px;
  transform: translate(-30px, -2px);
  width: 10px;
}

/* Remove tail for consecutive messages */
.message-bubble.no-tail::before {
  display: none;
}

/* Consecutive message spacing */
.message-bubble.consecutive {
  @apply mt-1;
}

.message-bubble:not(.consecutive) {
  @apply mt-3;
}

/* Margin adjustments for message containers */
.message-container {
  @apply mb-2;
}

.message-container.consecutive {
  @apply mb-1;
}

/* Special styling for different message types */
.message-bubble.error {
  @apply bg-red-100 text-red-800;
}

.message-bubble.error.from-bot::before {
  border-left-color: theme('colors.red.100');
}

.message-bubble.error.from-user {
  @apply bg-btn-red text-white;
}

.message-bubble.error.from-user::before {
  border-right-color: theme('colors.btn-red');
}

.message-bubble.success {
  @apply bg-green-100 text-green-800;
}

.message-bubble.success.from-bot::before {
  border-left-color: theme('colors.green.100');
}

.message-bubble.success.from-user {
  @apply bg-btn-green text-white;
}

.message-bubble.success.from-user::before {
  border-right-color: theme('colors.btn-green');
}

.message-bubble.system {
  @apply bg-yellow-100 text-yellow-800;
}

.message-bubble.system.from-bot::before {
  border-left-color: theme('colors.yellow.100');
}

.message-bubble.system.from-user {
  @apply bg-navigation-bg text-navigation-text;
}

.message-bubble.system.from-user::before {
  border-right-color: theme('colors.navigation-bg');
}

/* Emoji-only messages */
.message-bubble.emoji-only {
  @apply bg-transparent text-4xl p-1;
}

.message-bubble.emoji-only::before,
.message-bubble.emoji-only::after {
  display: none;
}

/* Audio-only messages */
.message-bubble.audio-only {
  @apply min-w-[180px];
}

/* Messages with audio content (with or without text) */
.message-bubble.has-audio {
  @apply min-w-[180px];
}

/* Fix mobile viewport issues and prevent empty touch areas */
.App {
  height: 100vh;
  height: 100dvh; /* Use dynamic viewport height on supported browsers */
  overflow: hidden;
}

/* CSS custom property for JavaScript fallback */
:root {
  --viewport-height: 100vh;
}

/* Prevent any unwanted spacing or touch areas */
body, html {
  touch-action: manipulation;
  overscroll-behavior: none;
}

/* Ensure no extra space at bottom on mobile */
@supports (-webkit-touch-callout: none) {
  .App {
    height: -webkit-fill-available;
  }
}

/* Prevent unwanted touch interactions and scrolling */
.chat-container {
  position: relative;
  height: 100%;
  overflow: hidden;
}

/* Ensure input area doesn't create extra space */
.input-area {
  position: relative;
  flex-shrink: 0;
  border-top: 1px solid theme('colors.separator-gray');
  background-color: theme('colors.card-bg');
}

/* Prevent any phantom touch areas */
.input-area::after {
  content: '';
  position: absolute;
  bottom: -1px;
  left: 0;
  right: 0;
  height: 1px;
  background: transparent;
  pointer-events: none;
}

/* Mobile Safari specific fixes */
@supports (-webkit-appearance: none) {
  .chat-container {
    height: 100vh;
    height: calc(var(--vh, 1vh) * 100);
  }
}

/* Prevent bounce scrolling on iOS and improve mobile experience */
.chat-container,
.input-area {
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: none;
}

/* Ensure proper stacking and positioning for mobile navigation bars */
@media (max-width: 768px) {
  /* Prevent content from being hidden behind system UI */
  .chat-container {
    /* Ensure content respects safe areas */
    padding-left: env(safe-area-inset-left, 0px);
    padding-right: env(safe-area-inset-right, 0px);
  }
  
  /* Input area positioning improvements */
  .input-area {
    /* Ensure it's always above navigation bars */
    position: relative;
    z-index: 1000;
    
    /* Prevent keyboard from pushing content up too much */
    transform: translateZ(0);
    -webkit-transform: translateZ(0);
  }
  
  /* Handle virtual keyboard appearance */
  @media (max-height: 500px) {
    .input-area {
      /* Reduce padding when keyboard is likely visible */
      padding-bottom: max(env(safe-area-inset-bottom, 0px), 8px);
    }
  }
}

/* Additional mobile viewport fixes */
@supports (padding: max(0px)) {
  .input-area {
    padding-left: max(1rem, env(safe-area-inset-left));
    padding-right: max(1rem, env(safe-area-inset-right));
  }
}

/* Ensure proper touch targets on mobile with navigation bar considerations */
@media (max-width: 768px) {
  .input-area button {
    min-height: 44px;
    min-width: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .input-area textarea {
    min-height: 44px;
  }
  
  /* Ensure form elements stay centered */
  .input-area form {
    align-items: center;
  }
  
  /* Additional spacing for devices with prominent navigation bars */
  @media (max-height: 700px) {
    .input-area {
      padding-bottom: max(env(safe-area-inset-bottom, 0px), 16px);
    }
  }
  
  /* Extra spacing for very small screens (older Android phones) */
  @media (max-height: 600px) {
    .input-area {
      padding-bottom: max(env(safe-area-inset-bottom, 0px), 20px);
    }
  }
  
  /* Landscape orientation handling */
  @media (orientation: landscape) {
    .input-area {
      padding-bottom: max(env(safe-area-inset-bottom, 0px), 8px);
    }
  }
}

/* Mobile viewport and safe area handling with Android navigation bar support */
@media (max-width: 768px) {
  /* Modern solution using dynamic viewport height */
  .chat-container {
    height: 100dvh; /* Dynamic viewport height - adjusts automatically */
    height: 100vh; /* Fallback for older browsers */
  }
  
  /* Input area with comprehensive Android navigation bar handling */
  .input-area {
    /* Safe area insets for devices that support it */
    padding-bottom: max(env(safe-area-inset-bottom, 0px), 12px);
    
    /* Ensure proper positioning above navigation bars */
    position: relative;
    z-index: 10;
  }
  
  /* Progressive enhancement for modern browsers with dvh support */
  @supports (height: 100dvh) {
    .chat-container {
      height: 100dvh;
    }
  }
  
  /* iOS Safari specific fix for older versions */
  @supports (-webkit-touch-callout: none) and (not (height: 100dvh)) {
    .chat-container {
      height: -webkit-fill-available;
    }
  }
  
  /* Android Chrome specific handling */
  @supports (height: -webkit-fill-available) and (not (height: 100dvh)) {
    .chat-container {
      height: -webkit-fill-available;
    }
  }
  
  /* Fallback for very old browsers using JavaScript-set custom properties */
  @supports not (height: 100dvh) and not (height: -webkit-fill-available) {
    .chat-container {
      height: calc(var(--vh, 1vh) * 100);
      height: var(--viewport-height, 100vh);
    }
  }
  
  /* Additional fallback class for JavaScript-enhanced elements */
  .js-viewport-height {
    height: var(--viewport-height, 100vh);
  }
  
  /* Debug utility classes (remove in production) */
  .debug-viewport-info::after {
    content: 'VH: ' var(--vh, 'N/A') ' | DVH: ' attr(data-dvh) ' | Fill: ' attr(data-fill);
    position: fixed;
    top: 10px;
    left: 10px;
    background: rgba(0, 0, 0, 0.8);
    color: white;
    padding: 4px 8px;
    font-size: 12px;
    z-index: 9999;
    border-radius: 4px;
  }
}

/* Safe area utility class - deprecated, keeping for compatibility */
.safe-area-bottom {
  padding-bottom: env(safe-area-inset-bottom, 0);
}
